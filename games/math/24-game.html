<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>2048 – Premium Edition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .tile {
      transition: transform 0.2s ease, background 0.2s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .tile-new { animation: appear 0.3s ease-out; }
    @keyframes appear {
      from { transform: scale(0.5); opacity: 0; } 
      to { transform: scale(1); opacity: 1; }
    }
    .score-updated {
      animation: bump 0.3s ease-in-out;
    }
    @keyframes bump {
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-300 dark:from-gray-900 dark:to-gray-800 min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md">
    <header class="text-center mb-6">
      <h1 class="text-6xl font-extrabold text-blue-700 dark:text-blue-400">2048</h1>
      <p class="text-sm text-gray-600 dark:text-gray-300">Swipe or use arrow keys to reach the <strong>2048</strong> tile!</p>
    </header>

    <div class="flex justify-between items-center mb-4">
      <div class="bg-white dark:bg-gray-700 rounded-lg px-4 py-2 shadow text-center w-32">
        <div class="text-xs uppercase font-bold text-gray-500 dark:text-gray-300">Score</div>
        <div id="score" class="text-2xl font-bold text-gray-800 dark:text-white">0</div>
      </div>
      <button id="new-game" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-all">New Game</button>
    </div>

    <div id="game-container" class="relative aspect-square">
      <div id="game-over-overlay" class="absolute inset-0 hidden z-10 flex flex-col items-center justify-center bg-black/60 rounded-lg">
        <div class="text-4xl font-extrabold text-white mb-4">Game Over</div>
        <button id="try-again" class="bg-white text-blue-600 px-4 py-2 font-bold rounded-lg shadow">Try Again</button>
      </div>
      <div id="grid-background" class="grid grid-cols-4 gap-2 bg-gray-300 dark:bg-gray-700 p-2 rounded-lg shadow-inner"></div>
      <div id="tile-container" class="absolute inset-0 p-2 pointer-events-none"></div>
    </div>

    <footer class="text-xs text-center text-gray-500 dark:text-gray-400 mt-4">Optimized & Designed with ❤️</footer>
  </div>

  <script>
    const tileColors = {
      2:'#eee4da',4:'#ede0c8',8:'#f2b179',16:'#f59563',
      32:'#f67c5f',64:'#f65e3b',128:'#edcf72',256:'#edcc61',
      512:'#edc850',1024:'#edc53f',2048:'#edc22e'
    };
    const game = {
      size:4, board:[], score:0, locked:false,
      gridEl:document.getElementById('grid-background'),
      tileEl:document.getElementById('tile-container'),
      scoreEl:document.getElementById('score'),
      overlay:document.getElementById('game-over-overlay'),
      init(){
        this.reset(); this.drawGrid(); this.addTile(); this.addTile(); this.render();
      },
      reset(){
        this.board = Array.from({length:this.size},()=>Array(this.size).fill(0));
        this.score = 0; this.locked = false;
        this.scoreEl.textContent = 0;
        this.overlay.classList.add('hidden');
      },
      drawGrid(){
        this.gridEl.innerHTML = '';
        for(let i=0;i<this.size*this.size;i++){
          this.gridEl.innerHTML += '<div class="bg-gray-200 dark:bg-gray-600 rounded-lg aspect-square"></div>';
        }
      },
      render(){
        this.tileEl.innerHTML = '';
        this.board.forEach((row,r)=>row.forEach((v,c)=>{
          if(!v) return;
          const div = document.createElement('div');
          div.textContent = v;
          div.className='tile absolute flex items-center justify-center';
          div.style.width = div.style.height = '25%';
          div.style.transform = `translate(${c*100}%,${r*100}%)`;
          div.style.background = tileColors[v] || '#3c3a32';
          div.style.color = (v<=4? '#776e65':'#f9f6f2');
          div.classList.add('tile-new');
          this.tileEl.appendChild(div);
        }));
        this.scoreEl.textContent = this.score;
      },
      addTile(){
        const empties = [];
        this.board.forEach((r,row)=> row.forEach((v,c)=> v===0 && empties.push([r,c])));
        if(!empties.length) return;
        const [r,c] = empties[Math.floor(Math.random()*empties.length)];
        this.board[r][c] = Math.random()<0.9? 2 : 4;
      },
      move(dir){
        if(this.locked) return;
        const prev = JSON.stringify(this.board);
        const rotate = (b,times)=> {
          for(let t=0;t<times;t++){
            b = b[0].map((_,i)=> b.map(row=>row[i]).reverse());
          }
          return b;
        };
        const compress = line => {
          let arr = line.filter(n=>n);
          for(let i=0;i<arr.length-1;i++){
            if(arr[i]===arr[i+1]){
              arr[i]*=2; this.score+=arr[i]; arr.splice(i+1,1);
            }
          }
          while(arr.length<this.size) arr.push(0);
          return arr;
        };
        let b = this.board;
        const mapDir = { up:0, right:1, down:2, left:3 };
        b = rotate(b,mapDir[dir]);
        b = b.map(compress);
        b = rotate(b,(4-mapDir[dir])%4);
        this.board = b;
        if(JSON.stringify(this.board)!==prev){
          this.locked = true;
          setTimeout(()=>{ this.addTile(); this.render(); this.locked=false; if(!this.canMove()) this.end(); }, 100);
        }
      },
      canMove(){
        for(let r=0;r<this.size;r++){
          for(let c=0;c<this.size;c++){
            const v=this.board[r][c];
            if(!v) return true;
            if(c<this.size-1 && v===this.board[r][c+1]) return true;
            if(r<this.size-1 && v===this.board[r+1][c]) return true;
          }
        }
        return false;
      },
      end(){
        this.locked = true;
        this.overlay.classList.remove('hidden');
      }
    };
    document.addEventListener('keydown',e=>{
      const map={ArrowUp:'up',ArrowDown:'down',ArrowLeft:'left',ArrowRight:'right'};
      if(map[e.key]) game.move(map[e.key]);
    });
    document.getElementById('new-game').onclick = ()=> {game.reset();game.addTile();game.addTile();game.render();}
    document.getElementById('try-again').onclick = ()=> {game.reset();game.addTile();game.addTile();game.render();}
    let sx,sy;
    document.getElementById('game-container').addEventListener('touchstart',e=>{
      sx=e.touches[0].clientX; sy=e.touches[0].clientY;
    });
    document.getElementById('game-container').addEventListener('touchend',e=>{
      const dx=e.changedTouches[0].clientX - sx;
      const dy=e.changedTouches[0].clientY - sy;
      if(Math.abs(dx)>Math.abs(dy)) game.move(dx>0?'right':'left');
      else game.move(dy>0?'down':'up');
    });
    game.init();
  </script>
</body>
</html>